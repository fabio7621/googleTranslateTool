<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å³æ™‚ç¿»è­¯å°è©±</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      #app {
        background: white;
        border-radius: 20px;
        width: 100%;
        max-width: 900px;
        height: 90vh;
        max-height: 800px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      /* é ‚éƒ¨æ¨™é¡Œå€ */
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
      }

      .header h1 {
        margin: 0;
        font-size: 24px;
      }

      .header p {
        margin: 5px 0 0 0;
        opacity: 0.9;
        font-size: 14px;
      }

      /* ç¿»è­¯æ–¹å‘åˆ‡æ› */
      .direction-switch {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
      }

      .direction-btn {
        padding: 8px 20px;
        border: 2px solid white;
        background: transparent;
        color: white;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }

      .direction-btn.active {
        background: white;
        color: #667eea;
      }

      /* å°è©±è¨˜éŒ„å€ */
      .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f5f5f5;
      }

      .message {
        margin-bottom: 15px;
        animation: slideIn 0.3s ease-out;
        display: flex;
        align-items: flex-start;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message-bubble {
        padding: 12px 16px;
        border-radius: 18px;
        max-width: 70%;
        word-wrap: break-word;
      }

      /* ä¸­æ–‡è¨Šæ¯ï¼ˆè¼¸å…¥çš„ï¼‰ */
      .message.zh .message-bubble {
        background: #667eea;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }

      /* è‹±æ–‡è¨Šæ¯ï¼ˆç¿»è­¯çš„ï¼‰ */
      .message.en .message-bubble {
        background: white;
        color: #333;
        margin-right: auto;
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .message-text {
        font-size: 15px;
        line-height: 1.4;
      }

      .timestamp {
        font-size: 10px;
        opacity: 0.6;
        margin-top: 4px;
      }

      /* è¼¸å…¥å€ */
      .input-area {
        padding: 20px;
        background: white;
        border-top: 1px solid #e0e0e0;
      }

      .input-container {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .input-box {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 25px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.3s;
      }

      .input-box:focus {
        border-color: #667eea;
      }

      /* èªè¨€åµæ¸¬æç¤º */
      .language-hint {
        text-align: center;
        font-size: 12px;
        color: #667eea;
        margin-bottom: 8px;
        min-height: 18px;
      }

      .mic-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: none;
        background: #667eea;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
        flex-shrink: 0;
      }

      .mic-btn:hover {
        background: #5568d3;
        transform: scale(1.1);
      }

      .mic-btn.recording {
        background: #ea4335;
        animation: pulse 1.5s infinite;
      }

      .send-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: none;
        background: #667eea;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
        flex-shrink: 0;
      }

      .send-btn:hover {
        background: #5568d3;
        transform: scale(1.1);
      }

      .send-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: scale(1);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      /* èªéŸ³ç‹€æ…‹ */
      .voice-status {
        text-align: center;
        color: #ea4335;
        font-size: 13px;
        margin-top: 8px;
        min-height: 20px;
      }

      /* éŒ¯èª¤è¨Šæ¯ */
      .error {
        background: #fee;
        color: #c33;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 10px;
        font-size: 13px;
      }

      /* ç©ºç‹€æ…‹ */
      .empty-state {
        text-align: center;
        color: #999;
        padding: 60px 20px;
      }

      .empty-state .icon {
        font-size: 60px;
        margin-bottom: 15px;
      }

      /* æ»¾å‹•æ¢ç¾åŒ– */
      .chat-container::-webkit-scrollbar {
        width: 6px;
      }

      .chat-container::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .chat-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
      }

      .chat-container::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- é ‚éƒ¨æ¨™é¡Œ -->
      <div class="header">
        <h1>ğŸ’¬ ä¸­è‹±å³æ™‚ç¿»è­¯å°è©±</h1>
        <p style="font-size: 14px">
          Click here to copy the current URL and use it in your browser
        </p>
        <button
          style="
            font-size: 18px;
            background-color: transparent;
            border: none;
            color: #fff;
          "
          id="copyUrlBtn"
        >
          é»æ­¤è¤‡è£½ç›®å‰ç¶²å€åˆ°ç€è¦½å™¨ä¸Šæ‰èƒ½ä½¿ç”¨èªéŸ³åŠŸèƒ½<i class="bi bi-link"></i>
        </button>
        <!-- ç¿»è­¯æ–¹å‘åˆ‡æ› -->
        <div class="direction-switch">
          <button
            class="direction-btn"
            :class="{ active: direction === 'zh-en' }"
            @click="changeDirection('zh-en')"
          >
            ä¸­æ–‡ â†’ è‹±æ–‡
          </button>
          <button
            class="direction-btn"
            :class="{ active: direction === 'en-zh' }"
            @click="changeDirection('en-zh')"
          >
            English â†’ Chinese
          </button>
        </div>
      </div>

      <!-- å°è©±è¨˜éŒ„å€ -->
      <div class="chat-container" ref="chatContainer">
        <!-- ç©ºç‹€æ…‹ -->
        <div v-if="messages.length === 0" class="empty-state">
          <div class="icon">ğŸ’¬</div>
          <p>é–‹å§‹ä½ çš„ç¬¬ä¸€æ¬¡ç¿»è­¯å°è©±å§ï¼</p>
          <p style="font-size: 12px; margin-top: 8px">
            âœ¨ æ‰“å­—è‡ªå‹•åµæ¸¬ä¸­è‹±æ–‡ï¼Œç„¡éœ€æ‰‹å‹•åˆ‡æ›(èªéŸ³éœ€æ‰‹å‹•åˆ‡æ›) âœ¨
          </p>
        </div>

        <!-- å°è©±è¨Šæ¯ - åªé¡¯ç¤ºç¿»è­¯çµæœ -->
        <div
          v-for="msg in messages"
          :key="msg.id"
          class="message"
          :class="msg.lang"
        >
          <div class="message-bubble">
            <div class="message-text">{{ msg.text }}</div>
            <div class="timestamp">{{ msg.time }}</div>
          </div>
        </div>
      </div>

      <!-- è¼¸å…¥å€ -->
      <div class="input-area">
        <!-- éŒ¯èª¤è¨Šæ¯ -->
        <div v-if="errorMessage" class="error">{{ errorMessage }}</div>

        <!-- èªè¨€åµæ¸¬æç¤º -->
        <div class="language-hint">{{ languageHint }}</div>

        <!-- èªéŸ³ç‹€æ…‹ -->
        <div class="voice-status">{{ voiceStatus }}</div>

        <!-- è¼¸å…¥æ¡† -->
        <div class="input-container">
          <button
            class="mic-btn"
            :class="{ recording: isRecording }"
            @click="toggleVoiceInput"
            :title="isRecording ? 'åœæ­¢éŒ„éŸ³' : 'èªéŸ³è¼¸å…¥'"
          >
            {{ isRecording ? 'â¹ï¸' : 'ğŸ¤' }}
          </button>

          <input
            type="text"
            class="input-box"
            v-model="inputText"
            placeholder="è¼¸å…¥ä¸­æ–‡æˆ–è‹±æ–‡ï¼Œç³»çµ±æœƒè‡ªå‹•åµæ¸¬..."
            @keyup.enter="sendMessage"
            @input="onInputChange"
            :disabled="isLoading"
          />

          <button
            class="send-btn"
            @click="sendMessage"
            :disabled="isLoading || !inputText.trim()"
            :title="isLoading ? 'ç¿»è­¯ä¸­...' : 'ç™¼é€'"
          >
            {{ isLoading ? 'â³' : 'â¤' }}
          </button>
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            inputText: "",
            direction: "zh-en",
            isLoading: false,
            errorMessage: "",
            languageHint: "",
            isRecording: false,
            voiceStatus: "",
            recognition: null,
            messages: [],
            maxMessages: 5,
          };
        },
        mounted() {
          this.initVoiceRecognition();
        },
        methods: {
          changeDirection(newDirection) {
            this.direction = newDirection;
            this.updateRecognitionLanguage();
          },

          // åµæ¸¬æ–‡å­—æ˜¯ä¸­æ–‡é‚„æ˜¯è‹±æ–‡
          detectLanguage(text) {
            const cleanText = text.trim();

            // æª¢æŸ¥æ˜¯å¦æœ‰ä¸­æ–‡å­—ç¬¦
            const chineseRegex = /[\u4e00-\u9fa5]/;
            const hasChinese = chineseRegex.test(cleanText);

            // æª¢æŸ¥æ˜¯å¦æœ‰è‹±æ–‡å­—æ¯
            const englishRegex = /[a-zA-Z]/;
            const hasEnglish = englishRegex.test(cleanText);

            // åˆ¤æ–·ä¸»è¦èªè¨€ï¼ˆå“ªå€‹å­—ç¬¦å¤šå°±æ˜¯å“ªå€‹èªè¨€ï¼‰
            if (hasChinese && hasEnglish) {
              // ä¸­è‹±æ··åˆï¼Œè¨ˆç®—å“ªå€‹å¤š
              const chineseCount = (cleanText.match(chineseRegex) || []).length;
              const englishCount = (cleanText.match(englishRegex) || []).length;
              return chineseCount >= englishCount ? "zh" : "en";
            } else if (hasChinese) {
              return "zh"; // ç´”ä¸­æ–‡
            } else if (hasEnglish) {
              return "en"; // ç´”è‹±æ–‡
            } else {
              return "unknown"; // ç„¡æ³•åˆ¤æ–·
            }
          },

          // ç•¶è¼¸å…¥æ¡†å…§å®¹æ”¹è®Šæ™‚
          onInputChange() {
            if (!this.inputText.trim()) {
              this.languageHint = "";
              return;
            }

            const detectedLang = this.detectLanguage(this.inputText);

            if (detectedLang === "zh") {
              this.languageHint = "ğŸ‡¹ğŸ‡¼ åµæ¸¬åˆ°ä¸­æ–‡ç‚ºä¸»ï¼Œå°‡ç¿»è­¯æˆè‹±æ–‡";
            } else if (detectedLang === "en") {
              this.languageHint = "ğŸ‡ºğŸ‡¸ åµæ¸¬åˆ°è‹±æ–‡ç‚ºä¸»ï¼Œå°‡ç¿»è­¯æˆä¸­æ–‡";
            } else {
              this.languageHint = "";
            }
          },

          async sendMessage() {
            if (!this.inputText.trim()) {
              this.errorMessage = "è«‹è¼¸å…¥æ–‡å­—";
              setTimeout(() => (this.errorMessage = ""), 2000);
              return;
            }

            // åµæ¸¬èªè¨€
            const detectedLang = this.detectLanguage(this.inputText);

            // åªæª¢æŸ¥æ˜¯å¦å®Œå…¨ç„¡æ³•è¾¨è­˜
            if (detectedLang === "unknown") {
              this.errorMessage = "âŒ ç„¡æ³•è¾¨è­˜çš„èªè¨€ï¼Œè«‹è¼¸å…¥ä¸­æ–‡æˆ–è‹±æ–‡";
              setTimeout(() => (this.errorMessage = ""), 3000);
              return;
            }

            this.isLoading = true;
            this.errorMessage = "";
            this.languageHint = "";

            try {
              // æ ¹æ“šåµæ¸¬åˆ°çš„èªè¨€è‡ªå‹•æ±ºå®šç¿»è­¯æ–¹å‘
              let sourceLang, targetLang, resultLang;

              if (detectedLang === "zh") {
                // åµæ¸¬åˆ°ä¸­æ–‡ç‚ºä¸»ï¼Œç¿»è­¯æˆè‹±æ–‡
                sourceLang = "zh-TW";
                targetLang = "en";
                resultLang = "en";
              } else {
                // åµæ¸¬åˆ°è‹±æ–‡ç‚ºä¸»ï¼Œç¿»è­¯æˆä¸­æ–‡
                sourceLang = "en";
                targetLang = "zh-TW";
                resultLang = "zh";
              }

              const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(this.inputText)}`;
              const response = await fetch(url);

              if (!response.ok) {
                throw new Error(`ç¿»è­¯å¤±æ•—: ${response.status}`);
              }

              const data = await response.json();
              const translatedText = data[0].map((item) => item[0]).join("");

              // åªåŠ å…¥ç¿»è­¯çµæœ
              const newMessage = {
                id: Date.now(),
                text: translatedText,
                time: this.getCurrentTime(),
                lang: resultLang,
              };

              this.messages.push(newMessage);

              // è¶…é 5 ç­†å°±åˆªé™¤æœ€èˆŠçš„
              if (this.messages.length > this.maxMessages) {
                this.messages.shift();
              }

              // æ¸…ç©ºè¼¸å…¥æ¡†
              this.inputText = "";

              // æ»¾å‹•åˆ°åº•éƒ¨
              this.$nextTick(() => {
                this.scrollToBottom();
              });
            } catch (error) {
              console.error("ç¿»è­¯éŒ¯èª¤:", error);
              this.errorMessage = "ç¿»è­¯å¤±æ•—: " + error.message;
            } finally {
              this.isLoading = false;
            }
          },

          getCurrentTime() {
            const now = new Date();
            return (
              now.getHours().toString().padStart(2, "0") +
              ":" +
              now.getMinutes().toString().padStart(2, "0")
            );
          },

          scrollToBottom() {
            const container = this.$refs.chatContainer;
            container.scrollTop = container.scrollHeight;
          },

          initVoiceRecognition() {
            const SpeechRecognition =
              window.SpeechRecognition || window.webkitSpeechRecognition;

            if (!SpeechRecognition) {
              console.warn("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è­˜åˆ¥");
              return;
            }

            this.recognition = new SpeechRecognition();
            this.recognition.continuous = false;
            this.recognition.interimResults = true;

            this.updateRecognitionLanguage();

            this.recognition.onresult = (event) => {
              let finalTranscript = "";

              for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;

                if (event.results[i].isFinal) {
                  finalTranscript += transcript;
                } else {
                  this.voiceStatus = "ğŸ¤ " + transcript;
                }
              }

              if (finalTranscript) {
                this.inputText = finalTranscript;
                this.voiceStatus = "âœ… è­˜åˆ¥å®Œæˆ";
                setTimeout(() => (this.voiceStatus = ""), 2000);

                // è§¸ç™¼èªè¨€åµæ¸¬
                this.onInputChange();
              }
            };

            this.recognition.onstart = () => {
              this.isRecording = true;
              this.voiceStatus = "ğŸ¤ è«‹é–‹å§‹èªªè©±...";
            };

            this.recognition.onend = () => {
              this.isRecording = false;
            };

            this.recognition.onerror = (event) => {
              this.isRecording = false;

              switch (event.error) {
                case "no-speech":
                  this.voiceStatus = "âš ï¸ æ²’æœ‰æª¢æ¸¬åˆ°èªéŸ³";
                  break;
                case "audio-capture":
                  this.voiceStatus = "âŒ ç„¡æ³•å­˜å–éº¥å…‹é¢¨";
                  break;
                case "not-allowed":
                  this.voiceStatus = "âŒ éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•";
                  break;
                default:
                  this.voiceStatus = "âŒ èªéŸ³è­˜åˆ¥éŒ¯èª¤";
              }

              setTimeout(() => (this.voiceStatus = ""), 3000);
            };
          },

          updateRecognitionLanguage() {
            if (!this.recognition) return;
            this.recognition.lang =
              this.direction === "zh-en" ? "zh-TW" : "en-US";
          },

          toggleVoiceInput() {
            if (!this.recognition) {
              this.errorMessage = "æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥";
              setTimeout(() => (this.errorMessage = ""), 3000);
              return;
            }

            if (this.isRecording) {
              this.recognition.stop();
            } else {
              this.errorMessage = "";
              this.recognition.start();
            }
          },
        },
      }).mount("#app");
    </script>

    <script>
      const copyBtn = document.getElementById("copyUrlBtn");

      copyBtn.addEventListener("click", async () => {
        try {
          const currentUrl = window.location.href;
          await navigator.clipboard.writeText(currentUrl);
          alert("ç¶²å€å·²è¤‡è£½ï¼");
        } catch (err) {
          alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
          console.error(err);
        }
      });
    </script>
  </body>
</html>
